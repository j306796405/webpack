{"version":3,"sources":["./src/js/page/index.js"],"names":[],"mappings":";;;;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,kBAAiB;AACjB;AACA;AACA;AACA;AACA;AACA;AACA;AACA,kBAAiB;AACjB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,UAAS;AACT;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,kBAAiB;AACjB;AACA;AACA;AACA;AACA;AACA;AACA;AACA,kBAAiB;AACjB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,UAAS;;AAET;AACA;AACA;AACA;AACA;AACA;AACA,UAAS;;AAET;AACA;AACA;AACA;AACA;AACA,UAAS;;AAET;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,UAAS;;AAET;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,UAAS;;AAET;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA,UAAS;AACT;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,MAAK;AACL;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,cAAa;AACb,UAAS;AACT;AACA;AACA,MAAK;AACL;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,UAAS;AACT;AACA,MAAK;AACL;AACA;AACA;AACA;AACA;AACA;AACA,UAAS;AACT;AACA,MAAK;AACL;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,cAAa;AACb,UAAS;AACT;AACA;AACA;;AAEA;AACA","sourcesContent":["/**\r\n * FileName index.js\r\n * Date 2016-06-27\r\n * Created by jianglinj\r\n */\r\nvar $ = require('jquery'),\r\n    template = require('artTemplate');\r\nvar data = {\r\n    selected: 0,\r\n    price: 123,\r\n    discount: 123,\r\n    tax: 123,\r\n    priceWithTax: 123,\r\n    isChecked: false,\r\n    products: [\r\n        {\r\n            specPerform: '日本KAO/花王纸尿裤专场',\r\n            isChecked: false,\r\n            forSales: [\r\n                {\r\n                    name: '日本KAO/花王纸尿裤专场-AAAAAAAAAAA',\r\n                    total: 1,\r\n                    limitNum: 3,\r\n                    price: 128,\r\n                    oldPrice: 300,\r\n                    isChecked: true\r\n                },\r\n                {\r\n                    name: '日本KAO/花王纸尿裤专场-BBBBBBBBBBBBB',\r\n                    total: 2,\r\n                    limitNum: 5,\r\n                    price: 256,\r\n                    oldPrice: 700,\r\n                    isChecked: false\r\n                },\r\n                {\r\n                    name: '日本KAO/花王纸尿裤专场-CCCCCCCCCC',\r\n                    total: 3,\r\n                    limitNum: 7,\r\n                    price: 512,\r\n                    oldPrice: 1000,\r\n                    isChecked: true\r\n                }\r\n            ]\r\n        },\r\n        {\r\n            specPerform: '高露洁辣妈用品专场',\r\n            isChecked: false,\r\n            forSales: [\r\n                {\r\n                    name: '高露洁辣妈用品专场-1111111111111111',\r\n                    total: 1,\r\n                    limitNum: 3,\r\n                    price: 128,\r\n                    oldPrice: 300,\r\n                    isChecked: false\r\n                },\r\n                {\r\n                    name: '高露洁辣妈用品专场-22222222222222222',\r\n                    total: 2,\r\n                    limitNum: 5,\r\n                    price: 256,\r\n                    oldPrice: 700,\r\n                    isChecked: false\r\n                },\r\n                {\r\n                    name: '高露洁辣妈用品专场-33333333333333',\r\n                    total: 3,\r\n                    limitNum: 7,\r\n                    price: 512,\r\n                    oldPrice: 1000,\r\n                    isChecked: false\r\n                }\r\n            ]\r\n        }\r\n\r\n    ]\r\n}\r\n\r\nfunction Cart(cartData, cartWrapper, templateId){\r\n    this.__cartData = cartData;\r\n    this.__cartWrapper = cartWrapper;\r\n    this.__templateId = templateId;\r\n\r\n    this._init = function(){\r\n        this._bind();\r\n    }\r\n\r\n    this._bind = function(){\r\n        var self = this;\r\n        //绑定产品点击事件\r\n        $('.J_cart_wrapper').on('click', '.J_check_product', function(){\r\n            var $this = $(this),\r\n                specPerformIndex = $this.data('spec-perform-index'),\r\n                productIndex = $this.data('product-index'),\r\n                isChecked = $this.prop('checked');\r\n            self._checkProductCheckbox(specPerformIndex, productIndex, isChecked);\r\n        })\r\n\r\n        //绑定专场点击事件\r\n        $('.J_cart_wrapper').on('click', '.J_check_specPerform', function(){\r\n            var $this = $(this),\r\n                specPerformIndex = $this.data('spec-perform-index'),\r\n                isChecked = $this.prop('checked');\r\n            self._checkSpecPerform(specPerformIndex, isChecked);\r\n        })\r\n\r\n        //绑定全选点击事件\r\n        $('.J_cart_wrapper').on('click', '.J_check_all', function(){\r\n            var $this = $(this),\r\n                isChecked = $this.prop('checked');\r\n            self._checkAll(isChecked);\r\n        })\r\n\r\n        //点击减少按钮\r\n        $('.J_cart_wrapper').on('click', '.J_minus_product', function(){\r\n            var $this = $(this),\r\n                total = $this.data('total'),\r\n                specPerformIndex = $this.data('spec-perform-index'),\r\n                productIndex = $this.data('product-index');\r\n            if(total > 1){\r\n                self.__cartData.products[specPerformIndex].forSales[productIndex].total = (total - 1);\r\n            }\r\n            self._renderCart();\r\n        })\r\n\r\n        //点击增加按钮\r\n        $('.J_cart_wrapper').on('click', '.J_add_product', function(){\r\n            var $this = $(this),\r\n                total = $this.data('total'),\r\n                specPerformIndex = $this.data('spec-perform-index'),\r\n                productIndex = $this.data('product-index'),\r\n                limitNum = self.__cartData.products[specPerformIndex].forSales[productIndex].limitNum;\r\n            if(total < limitNum){\r\n                self.__cartData.products[specPerformIndex].forSales[productIndex].total = (total + 1);\r\n            }\r\n            self._renderCart();\r\n        })\r\n\r\n        //点击删除产品按钮\r\n        $('.J_cart_wrapper').on('click', '.J_delete_product', function(){\r\n            var $this = $(this),\r\n                specPerformIndex = $this.data('spec-perform-index'),\r\n                productIndex = $this.data('product-index');\r\n\r\n            self.__cartData.products[specPerformIndex].forSales.splice(productIndex, 1);\r\n            self._checkProductCheckbox(specPerformIndex, null, null);\r\n            self._renderCart();\r\n        })\r\n    }\r\n\r\n    this._init();\r\n}\r\n\r\nCart.prototype = {\r\n    constructor: Cart,\r\n    //绘制购物车\r\n    _renderCart: function(){\r\n        this._syncModel();\r\n        var html = template(this.__templateId, this.__cartData);\r\n        $(this.__cartWrapper).html(html);\r\n    },\r\n    //同步Model, 更新全选checkbox，discount， price, priceWithTax, tax\r\n    _syncModel: function(){\r\n        var discount,\r\n            price = 0,\r\n            priceWithTax,\r\n            selected = 0,\r\n            tax,\r\n            self = this;\r\n\r\n        self.__cartData.isChecked = true;\r\n        $.each(self.__cartData.products, function(i, specPerform){\r\n            if(!specPerform.isChecked){\r\n                self.__cartData.isChecked = false;\r\n            }\r\n            $.each(specPerform.forSales, function(i, product){\r\n                if(product.isChecked){\r\n                    price += (product.price * product.total);\r\n                    selected += 1;\r\n                }\r\n            })\r\n        })\r\n        self.__cartData.price = price;\r\n        self.__cartData.selected = selected;\r\n    },\r\n    //点击产品checkbox\r\n    _checkProductCheckbox: function(specPerformIndex, productIndex, isChecked){\r\n        var self = this;\r\n        self.__cartData.products[specPerformIndex].isChecked = true;\r\n        $.each(self.__cartData.products[specPerformIndex].forSales, function(i, product){\r\n            if(productIndex === i){\r\n                product.isChecked = isChecked;\r\n            }\r\n            if(!product.isChecked){\r\n                self.__cartData.products[specPerformIndex].isChecked = false;\r\n            }\r\n        })\r\n        this._renderCart();\r\n    },\r\n    //点击专场checkbox\r\n    _checkSpecPerform: function(specPerformIndex, isChecked){\r\n        var self = this;\r\n        self.__cartData.products[specPerformIndex].isChecked = isChecked;\r\n        $.each(self.__cartData.products[specPerformIndex].forSales, function(i, product){\r\n            product.isChecked = isChecked;\r\n        })\r\n        self._renderCart();\r\n    },\r\n    //点击所有全选\r\n    _checkAll: function(isChecked){\r\n        var self = this;\r\n        self.__cartData.isChecked = isChecked;\r\n        $.each(self.__cartData.products, function(i, specPerform){\r\n            specPerform.isChecked = isChecked;\r\n            $.each(self.__cartData.products[i].forSales, function(j, product){\r\n                product.isChecked = isChecked;\r\n            })\r\n        })\r\n        self._renderCart();\r\n    }\r\n}\r\n\r\nvar cart = new Cart(data, '.J_cart_wrapper', 'J_cartTemplate');\r\ncart._renderCart();\r\n"],"sourceRoot":"webpack-module://"}